generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
}

enum Package {
  BASIC
  STANDARD
  PREMIUM
}

enum Status {
  NEW
  UNDER_REVIEW
  NEED_DOCS
  READY
  BOOKING
  FILED
  COMPLETED
  REJECTED
}

enum PaymentStatus {
  PENDING
  PAID
  REFUNDED
  FAILED
}

enum Direction {
  USER_TO_ADMIN
  ADMIN_TO_USER
}

model User {
  id           String        @id @default(cuid())
  email        String        @unique
  name         String?
  role         Role          @default(USER)
  applications Application[]
  messages     Message[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model Application {
  id                     String         @id @default(cuid())
  userId                 String
  user                   User           @relation(fields: [userId], references: [id])
  fullName               String
  phone                  String
  citizenship            String
  destination            String
  visaType               String
  travelStart            DateTime?
  travelEnd              DateTime?
  passportExpiry         DateTime?
  package                Package        @default(STANDARD)
  status                 Status         @default(NEW)
  paymentStatus          PaymentStatus  @default(PENDING)
  amountTRY              Int
  files                  File[]
  notes                  Note[]
  messages               Message[]
  appointmentProposedAt  DateTime?
  appointmentConfirmedAt DateTime?
  createdAt              DateTime       @default(now())
  updatedAt              DateTime       @updatedAt
}

model File {
  id            String       @id @default(cuid())
  applicationId String
  application   Application  @relation(fields: [applicationId], references: [id])
  type          String
  url           String
  approved      Boolean      @default(false)
  createdAt     DateTime     @default(now())
}

model Note {
  id            String       @id @default(cuid())
  applicationId String
  application   Application  @relation(fields: [applicationId], references: [id])
  authorId      String?
  body          String
  createdAt     DateTime     @default(now())
}

model Message {
  id            String       @id @default(cuid())
  applicationId String
  application   Application  @relation(fields: [applicationId], references: [id])
  userId        String?
  body          String
  direction     Direction
  createdAt     DateTime     @default(now())
}

model EmailTemplate {
  id        String   @id @default(cuid())
  code      String   @unique
  subject   String
  html      String
  createdAt DateTime @default(now())
}
